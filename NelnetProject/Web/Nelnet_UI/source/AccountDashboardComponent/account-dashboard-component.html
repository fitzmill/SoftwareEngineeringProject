<div style="position: relative;">
    <h1>Account Dashboard</h1>
    <button class="btn btn-primary btn-logout" data-bind="click: $parent.logout">Logout</button>

    <div class="card card-account-information-section">
        <div class="card-header">
            <h3 class="header-information-section">Personal Information</h3>
            <button id="btn-edit-personal" class="btn btn-primary btn-edit edit-personal-inactive" data-bind="click: startEditing">Edit</button>
            <button id="btn-save-edit-personal" class="btn btn-success btn-edit edit-personal-active" data-bind="click: updateUser" style="display: none;">Save</button>
            <button id="btn-cancel-edit-personal" class="btn btn-default btn-edit edit-personal-active" data-bind="click: stopEditing" style="display: none;">Cancel</button>
        </div>
        <div class="card-body">
            <h5 id="edit-personal-input-error" class="header-input-error" data-bind="text: personalInputErrorMessage" style="display: none;"></h5>
            
            <h4 class="edit-personal-inactive" data-bind="text: UserFirstName() + ' ' + UserLastName()"></h4>
            <h4 class="edit-personal-inactive" data-bind="text: Email"></h4>

            <div class="edit-personal-active">
                <form id="edit-personal-form">
                    <input name="dashboard-first-name no-code-chars" class="input-information" placeholder="First Name" data-bind="value: UserFirstName" required />
                    <input name="dashboard-last-name no-code-chars" class="input-information" placeholder="Last Name" data-bind="value: UserLastName" required /> <br />
                    <input name="dashboard-email" class="input-information" type="email" placeholder="Email" data-bind="value: Email" />
                </form>
            </div>
            
        </div>
    </div>
    <h5 id="retryingTransactionError" class="header-input-error" style="display: none;">You have an unresolved transaction, if you haven't already, try updating your payment information below </h5>
    <div class="card card-account-information-section">
        <div class="card-header">
            <h3 class="header-information-section">Payment Information</h3>
            <button id="btn-edit-payment" class="btn btn-primary btn-edit edit-payment-inactive" data-bind="click: startEditing">Edit</button>
            <button id="btn-save-edit-payment" class="btn btn-success btn-edit edit-payment-active" data-bind="click: updatePaymentInfo">Save</button>
            <button id="btn-cancel-edit-payment" class="btn btn-default btn-edit edit-payment-active" data-bind="click: stopEditing">Cancel</button>
        </div>
        <div class="card-body">
            <h5 data-bind="text: 'Payment Plan: ' + PaymentPlan()"></h5>
            <label>Next Payment Due: </label>
            <label class="enMoney" data-bind="text: NextPaymentCost"></label>
            <label data-bind="text: ' on ' + NextPaymentDate()"></label>
        </div>
        <div class="card-footer" style="background-color: white;">
            <h5 id="edit-payment-input-error" class="header-input-error" data-bind="text: paymentInputErrorMessage" style="display: none;"></h5>
            <div id="payment-information" class="edit-payment-inactive">
                <h5 data-bind="text: 'XXXX XXXX XXXX ' + CardNumber()"></h5>
                <label data-bind="text: 'Exp: ' + ExpirationMonth() + '/' + ExpirationYear()"></label>
            </div>


            <div id="edit-payment-input" class="edit-payment-active">
                <input class="input-information" type="number" placeholder="Credit Card Number" min="0" data-bind="value: CardNumber" style="display: block;" />
                <select class="select-inline-info" data-bind="options: $root.dropdownOptions.Months, value: ExpirationMonth, optionsCaption: 'MM'"></select>
                <select class="select-inline-info" data-bind="options: $root.dropdownOptions.Years, value: ExpirationYear, optionsCaption: 'YYYY'"></select>
            </div>
        </div>
    </div>

    <div class="card card-account-information-section">
        <div class="card-header">
            <h3 class="header-information-section">Billing Information</h3>
            <button id="btn-edit-billing" class="btn btn-primary btn-edit edit-billing-inactive" data-bind="click: startEditing">Edit</button>
            <button id="btn-save-edit-billing" class="btn btn-success btn-edit edit-billing-active" data-bind="click: updateBillingInfo">Save</button>
            <button id="btn-cancel-edit-billing" class="btn btn-default btn-edit edit-billing-active" data-bind="click: stopEditing">Cancel</button>
        </div>
        <div class="card-body">
            <h5 id="edit-billing-input-error" class="header-input-error" data-bind="text: billingInputErrorMessage" style="display: none;"></h5>

            <div class="edit-billing-inactive">
                <h5 data-bind="text: CardFirstName() + ' ' + CardLastName()"></h5>
                <h5 data-bind="text: StreetAddress1"></h5>
                <h5 data-bind="text: StreetAddress2"></h5>
                <h5 data-bind="text: City() + ', ' + State() + ' ' + Zip()"></h5>
            </div>


            <div class="edit-billing-active">
                <div style="display: block;">
                    <input type="text" placeholder="First Name" data-bind="value: CardFirstName" />
                    <input type="text" placeholder="Last Name" data-bind="value: CardLastName" />
                </div>
                <input class="input-street-address input-information" type="text" placeholder="Street Address 1" data-bind="value: StreetAddress1" />
                <input class="input-street-address input-information" type="text" placeholder="Street Address 2" data-bind="value: StreetAddress2" />
                <div style="display: block; margin-bottom: 30px;">
                    <input class="input-information" type="text" placeholder="City" data-bind="value: City" />
                    <select class="select-inline-info" data-bind="options: $parent.dropdownOptions.States, value: State, optionsCaption: 'State'"></select>
                    <input class="input-information" type="text" placeholder="Zip Code" data-bind="value: Zip" />
                </div>
            </div>
        </div>
    </div>

    <div class="card card-account-information-section">
        <div class="card-header">
            <h3 class="header-information-section">Student Information</h3>
            <button id="btn-edit-student" class="btn btn-primary btn-edit edit-student-inactive" data-bind="click: startEditing">Edit</button>
            <button id="btn-save-edit-student" class="btn btn-success btn-edit edit-student-active" data-bind="click: updateStudents">Save</button>
            <button id="btn-cancel-edit-student" class="btn btn-default btn-edit edit-student-active" data-bind="click: stopEditing">Cancel</button>
        </div>
        <h5 id="edit-student-input-error" class="header-input-error" data-bind="text: studentInputErrorMessage" style="display: none;"></h5>
        <div data-bind="foreach: Students">
            <div>
                <h5 class="student-info edit-student-inactive" data-bind="text: FirstName() + ' ' + LastName()" style="margin-top: 20px"></h5>
                <h5 class="student-info edit-student-inactive" data-bind="text: Grade() === undefined ? undefined : $root.dropdownOptions.Grades.find((obj) => obj.num == Grade()).text"></h5>

                <button id="btn-delete-student" class="btn btn-danger edit-student-active" data-bind="click: function(student) { $parent.openConfirmModal(student, 'You are about to delete a student, are you sure?', $parent.deleteStudent) }">Delete Student</button>
                <div class="student-info edit-student-active">
                    <input class="input-information" type="text" placeholder="Student First Name" data-bind="value: FirstName" />
                    <input class="input-information" type="text" placeholder="Student Last Name" data-bind="value: LastName" />
                </div>
                <select class="select-inline-info edit-student-active student-info" data-bind="options: $root.dropdownOptions.Grades, optionsText: 'text', optionsValue: 'num', value: Grade, optionsCaption: 'Grade'" style="margin-bottom: 10px"></select>

            </div>
        </div>

        <button class="btn btn-primary edit-student-active" data-bind="click: addStudent">Add Another Student</button>
    </div>

    <div class="card card-account-information-section">
        <div class="card-header">
            <h3 class="header-information-section">Transaction History</h3>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date Due</th>
                        <th>Amount Charged</th>
                        <th>
                            Process State
                            <img id="processStateInformation" src="../assets/images/information_icon.png" height="20" width="20" data-toggle="tooltip" data-html="true"
                                 title="RETRYING: The system is attempting to charge this transaction again <br>
                            FAILED: The system has retried the maximum amount of times, <br>
                            DEFERRED: This transaction has been added to a new transaction with a late fee"/>
                        </th>
                        <th>Reason Failed</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: Transactions">
                    <tr>
                        <td data-bind="text: DateDue"></td>
                        <td data-bind="text: AmountCharged"></td>
                        <td data-bind="text: ProcessState"></td>
                        <td data-bind="text: ReasonFailed"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!--ConfirmModal-->
    <div id="confirmModal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static" data-bind="with: confirmModalData">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Warning</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4 data-bind="text: warningMessage"></h4>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal" style="float: right;">Cancel</button>
                    <button class="btn btn-success" data-bind="click: function () { confirmAction(data) }" style="float: right;">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <!--/ConfirmModal-->
</div>